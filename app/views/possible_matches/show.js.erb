
$('#possible_matches').html("<%= escape_javascript(render('show_possibilities'), locals: {possible_matches: @contemplated_piece , @suggested_pieces}%>")
(function(){
	var app = angular.module('GodsOfRiotry', ['ngRoute', 'ngAnimate']);

	app.controller('PossibleMatches', ['$scope', '$rootScope', '$timeout', '$interval', '$sce', 
					   function($scope, $rootScope, $timeout, $interval, $sce){
					   	
					   	$scope.suggested_tops = {
					   		
					   		suggested_tops = new Array;

					   		upload: function(){
						   		
						   		for(i = 0; i < (gon.possible_matches_suggested_tops).length; i++)
							   		this += {
							   			id: temp[i].id,
							   			image: temp[i].image.picture,
							   			price: temp[i].price,
				  						description: temp[i].description,
				  						merch_type: temp[i].merch_type,
				  						standalone: temp[i].standalone
							   		}
							   	}
							}   	

					   	}();

					   	$scope.suggested_bottoms = {
					   			
					   			suggested_bottoms = new Array;

					   			upload: function(){

					   				for (i = 0; i < (gon.possible_matches_suggested_bottoms).length; i++){
					   					this.suggested_bottoms += {
					   						gon.possible_matches_suggested_bottoms[i].id,
					   						gon.possible_matches_suggested_bottoms[i].image.picture,
					   						gon.possible_matches_suggested_bottoms[i].price,
					   						gon.possible_matches_suggested_bottoms[i].description,
					   						gon.possible_matches_suggested_bottoms[i].merch_type,
					   						gon.possible_matches_suggested_bottoms[i].standalone
					   					}
					   				}
					   			}
					   	};


					   	$scope.tops = {
					   			
					   			tops = new Array;					   			

					   			upload: function(){

					   				for(i=0; i < gon.possible_matches_suggested_tops; i++){
					   					this.tops += {
					   						gon.possible_matches_suggested_tops[i].id,
					   						gon.possible_matches_suggested_tops[i].image.picture,
					   						gon.possible_matches_suggested_tops[i].price,
					   						gon.possible_matches_suggested_tops[i].description,
					   						gon.possible_matches_suggested_tops[i].merch_type,
					   						gon.possible_matches_suggested_tops[i].standalone
					   					}
					   				}

					   				for(i = 0; i < gon.possible_matches_extra_tops; i++){
					   					this.tops += {
					   					 	gon.possible_matches_extra_tops[i].id,
					   					 	gon.possible_matches_extra_tops[i].image.picture,
					   					 	gon.possible_matches_extra_tops[i].price,
					   					 	gon.possible_matches_extra_tops[i].description,
					   					 	gon.possible_matches_extra_tops[i].merch_type,
					   					 	gon.possible_matches_extra_tops[i].standalone
					   					}
					   				}

					   				for(i = 0; i < gon.gor_clothing_standalone_tops; i++){
					   					this.tops += {
					   						gon.gor_clothing_standalone_tops[i].id,
					   						gon.gor_clothing_standalone_tops[i].image.picture,
					   						gon.gor_clothing_standalone_tops[i].price,
					   						gon.gor_clothing_standalone_tops[i].description,
					   						gon.gor_clothing_standalone_tops[i].merch_type,
					   						gon.gor_clothing_standalone_tops[i].standalone
					   					}
					   				}
					   	};

					   	$scope.bottoms = {
					   			
					   			bottoms = new Array;

					   			upload: function(){

					   				for (i = 0; i < gon.possible_match_suggested_bottoms.length; i++){
						   				this.bottoms += {
						   					gon.possible_match_suggested_bottoms[i].id,
						   					gon.possible_match_suggested_bottoms[i].image.picture,
						   					gon.possible_match_suggested_bottoms[i].price,
						   					gon.possible_match_suggested_bottoms[i].description,
						   					gon.possible_match_suggested_bottoms[i].merch_type,
						   					gon.possible_match_suggested_bottoms[i].standalone
						   				}
						   			}	

						   			for (i = 0; i < gon.possible_matches_extra_bottoms.length; i++){
						   				this.bottoms += {
						   					gon.possible_matches_extra_bottoms[i].id,
						   					gon.possible_matches_extra_bottoms[i].image.picture,
						   					gon.possible_matches_extra_bottoms[i].price,
						   					gon.possible_matches_extra_bottoms[i].description,
						   					gon.possible_matches_extra_bottoms[i].merch_type,
						   					gon.possible_matches_extra_bottoms[i].standalone
						   				}
						   			}

						   			for(i = 0; i < gon.gor_clothing_standalone_bottoms.length; i++){
						   				this.bottoms += {
						   					gon.gor_clothing_standalone_bottoms[i].id,
						   					gon.gor_clothing_standalone_bottoms[i].image.picture,
						   					gon.gor_clothing_standalone_bottoms[i].price,
						   					gon.gor_clothing_standalone_bottoms[i].description,
						   					gon.gor_clothing_standalone_bottoms[i].merch_type,
						   					gon.gor_clothing_standalone_bottoms[i].standalone
						   				}
						   			}

						   		}
						};
					   

					   	$scope.contemplated_piece = {

					   		contemplated_piece = new Array;

						   	upload: function(){
					   			
					   			this.contemplated_piece += {
						   			id: gon.contemplated_piece.id, 
						   			image: gon.contemplated_piece.image.picture,
						   			price: gon.contemplated_piece.price,
						   			description: gon.contemplated_piece.description,
						   			merch_type: gon.contemplated_piece.merch_type,
						   			standalone: gon.contemplated_piece.standalone
					   			}
						   	}
					   	};
					   	

						$rootScope.temporary_matches = function(){
							if (angular.isDefined(initiateAutomaticToggle))
								return;
							
							var contemplated = angular.element(document).find('#contemplated_piece_<%= @contemplated_piece.id %>');
							
							//JsRoutes --> make element a contemplated_piece
							this = new Array;

							initiateAutomaticToggle = function(){

								this += {id: $scope.suggested_piece.id,
									   image: $scope.suggested_piece.image.picture,
									   price: $scope.suggested_piece.price,
									   description: $scope.suggested_piece.description,
									   merch_type: $scope.suggested_piece.merch_type
								}

								var array = $scope.suggested_pieces;

								for(i = 0; i < array.length - 1; i++){
									this += {
										id: array[i].id,
										image: array[i].image.picture,
										price: array[i].price,
										description: array[i].description,
										merch_type: array[i].merch_type
									}
								}
							};


						   	$timeout(function(){
						   		$scope.suggested_piece = array[array.length - 1];
						   	}, 100);

						   	var index = 0;

						   	var ToggleSuggPieces;
						   	ToggleSuggPieces = $interval(function(){
						   		if(index > array.length - 1){
						   			index = 0;
						   		}
						   		$scope.suggested_piece = array[index];
						   		index++;
						   	}, 8000);

						   	var array = $scope.suggested_pieces;

						}

						$scope.stopAutomaticToggle = function(){
								if (angular.isDefined(initiateAutomaticToggle)){
									$interval.cancel(initiateAutomaticToggle);
									initiateAutomaticToggle = undefined;
								}
						}

						$scope.$on('$destroy', function(){
							$scope.stopAutomaticToggle();
						});

						function placeholder(){
							var element = this,
						
							temp = {suggested_pieces: {if ($('#non_suggested_bottom_<%= gor_clothing.id %>').length){
												element.find('#non_suggested_bottom_<%= gor_clothing.id %>');
											} ||
										         if ($('#non_suggested_top_<%= gor_clothing.id %>').length){
										         		element.find('#non_suggested_top_<%= gor_clothing.id %>');
											} ||
											if ($('#suggested_piece_<%= suggested_piece.id %>').length){
										         		element.find('#suggested_piece_<%= suggested_piece.id %>');
											}},
								  contemplated_piece: {if ($('#contemplated_piece_<%=@contemplated_piece.id%>').length){
												element.find('#contemplated_piece_<%= @contemplated_piece.id%>');
											}},
								  standalone_tops: {if ($('#standalone_tops_<%= gor_clothing.id%>').length){
								  				element.find('#standalone_tops_<%= gor_clothing.id %>');
								  		      }},
								  standalone_bottoms: {if ($('#standalone_bottoms_<%= gor_clothing.id %>').length){
								  				element.find('#standalone_bottoms_<%= gor_clothing.id %>');
								  			}}
							};				    
							
							switch(temp){
								case temp.suggested_pieces:
								break;

								case temp.contemplated_piece:
									timeout(function(){
										$scope.temporary_matches 
										if 
										  
									}, 6000);
								break;

								case temp.standalone_tops:
								break;

								case temp.standalone_bottoms:
								break;

								default:
							}
						}


						$('#possible_matches').keydown(function(e) {
							
						    $scope.stopAutomaticToggle();

						    switch(e.which) {
						        case 37: // left
						        break;

						        case 38: // up
						        break;

						        case 39: // right
						        break;

						        case 40: // down
						        break;

						        default: return; // exit this handler for other keys
						    }
						    e.preventDefault(); // prevent the default action (scroll / move caret)
						});

					   }]);

	app.animation('.possible_pieces', ['$timeout', '$rootScope' function($timeout){

		return {
			enter: function(element, done){

				var img = angular.element(element.children()[0]);
				var price = angular.element(element.children()[1]);
				var description = angular.element(element.children()[2]);
				angular.element(element.toggleClass('#contemplated_piece_<%=@contemplated_piece%>'));
				$rootScope.temporary_matches();

				img.css({
					opacity: 0
				});
				price.css({
					opacity: 0
				});
				description.css({
					opacity: 0
				});
				img.animate({
					opacity: 1
				}, 500, function(){
					var eventfire = false;
					img.on('mouseover', function(){
						eventfire = true;
						price.css({opacity: 1});
						description.css({opacity: 1});
					}).off('mouseover', function(){
						price.css({opacity: 0});
						description.css({opacity: 0});
					});
						//Show reminder to user
						
				}());
			},

			leave: function(element, done){

				var img = angular.element(element.children()[0]);
				var price = angular.element(element.children()[1]);
				var description = angular.element(element.children()[2]);

				img.css({
					opacity: 1
				});

				img.animate({
					opacity: 0
				}, 500);

				if angular.element(element.hasClass('#contemplated_piece_<%=@contemplated_piece.id%>')){
					angular.element(element.removeClass('#contemplated_piece_<%=@contemplated_piece.id%>'));
				}	

			}
		};
	}]);
})();
<%end%>

