<% content_for :show do %>
$('#possible_matches').html(escape_javascript(render partial: 'show_possibilities', locals: {possible_matches: @contemplated_piece , @suggested_pieces})
(function(){
	var app = angular.module('GodsOfRiotry', ['ngRoute', 'ngAnimate']);

	app.controller('PossibleMatches', ['$scope', '$timeout', '$interval', '$sce', 
					   function($scope, $timeout, $interval, $sce){
					   	
					   	$scope.suggested_tops = function(){
					   		this = new Array;

					   		var temp = #{raw @possible_matches_suggested_tops}

					   		for(i = 0; i < temp.length; i++)
						   		this += {
						   			id: temp[i].id,
						   			image: temp[i].image.picture,
						   			price: temp[i].price,
			  						description: temp[i].description
						   		}
						   	}
					   	}();

					   	$scope.suggested_bottoms = function(){
					   			this = new Array;

					   			var temp = #{raw @possible_matches_suggested_bottoms};

					   			for(i = 0; i < temp.length; i++){
					   				this += {
					   					id: temp[i].id,
					   					image: temp[i].image.picture,
					   					price: temp[i].price,
					   					description: temp[i].description
					   				}
					   			}	
					   	}();

					   	$scope.tops = function(){
					   			this = new Array;

					   			var temp = #{raw @possible_matches_suggested_tops}
					   			
					   			var list = #{raw @possible_matches_extra_tops} 
					   			for(i = 0; i < list.length; i++){
					   				temp.push(list[i]);
					   			}
					   				
					   			for(i = 0; i < temp.length; i++){
					   				this += {
					   					id: temp[i].id,
					   					image: temp[i].image.picture,
					   					price: temp[i].price,
					   					description: temp[i].description
					   				}
					   			}	
					   	}();

					   	$scope.bottoms = function(){
					   			this = new Array;

					   			var temp = #{raw @possible_match_suggested_bottoms}

					   			var list = #{raw @possible_match_extra_bottoms}
					   			for(i = 0; i < list.length; i++){
					   				temp.push(list[i]);
					   			}

					   			for(i = 0; i < temp.length; i++){
					   				this += {
					   					id: temp[i].id,
					   					image: temp[i].image.picture,
					   					price: temp[i].price,
					   					description: temp[i].description
					   				}
					   			}
					   	}();


					   	$scope.contemplated_piece = function(){
					   		this = new Array;

				   			var temp = #{raw @contemplated_piece} 
				   			
				   			this += {
					   			id: temp.id, 
					   			image: temp.image.picture,
					   			price: temp.price,
					   			description: temp.description
				   			}
					   	}();

					   	$scope.suggested_pieces = function(){
					   		this = new Array;

					   		var temp = #{raw @suggested_pieces}

					   		for(i = 0; i < temp.length; i++){
					   			this += {
					   				id: temp[i].id,
					   				image: temp[i].image.picture,
					   				price: temp[i].price,
					   				description: temp[i].description
					   			}

					   		}
					   	}();


					   	var array = $scope.suggested_pieces;

					   	$timeout(function(){
					   		$scope.suggested_piece = array[array.length - 1];
					   	}, 100);

					   	var index = 0;

					   	$interval(function(){
					   		if(index > array.length - 1){
					   			index = 0;
					   		}
					   		$scope.suggested_piece = array[index];
					   		index++;
					   	}, 8000);

					   }]);

	app.animation('.possible_pieces', ['$timeout', function($timeout){

		return {
			enter: function(element, done){

				var img = angular.element(element.children()[0]);
				var price = angular.element(element.children()[1]);
				var description = angular.element(element.children()[2]);

				img.css({
					opacity: 0
				});
				price.css({
					opacity: 0
				});
				description.css({
					opacity: 0
				});
				img.animate({
					opacity: 1
				}, 500, function(){
					img.on('mouseover', function(){
						price.css({opacity: 1});
						description.css({opacity: 1});
					}).off('mouseover', function(){
						price.css({opacity: 0});
						description.css({opacity: 0});
					});
				}());
			},

			leave: function(element, done){

				var img = angular.element(element.children()[0]);
				var price = angular.element(element.children()[1]);
				var description = angular.element(element.children()[2]);

				img.css({
					opacity: 1
				});

				img.animate({
					opacity: 0
				}, 500);
			}
		};
	}]);
})();
<%end%>

